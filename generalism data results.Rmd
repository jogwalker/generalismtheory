---
title: "Generalism data results"
author: "Josephine Walker"
date: "19 July 2016"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, echo=FALSE,warning=FALSE,error=FALSE,message=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(MASS)
setwd("~/dat/generalismtheory/")
```

```{r cleanmore,echo=FALSE,eval=FALSE}
load("dat.ph.drop.RData")
dat.ph.2 <- dat.ph.drop
dat.ph.2$Definitive <- 0
dat.ph.2$Definitive[dat.ph.2$Host_stage=="Definitive" | dat.ph.2$Host_stage=="Both"] <- 1
dat.ph.2$Intermediate <- 0
dat.ph.2$Intermediate[dat.ph.2$Host_stage=="Intermediate" | dat.ph.2$Host_stage=="Both"] <- 1
dat.ph.def <- dat.ph.2 %>% filter(Definitive==1)
# correct a few additional host names so they match phylogenetic data
dat.ph.def$new_hname <- as.character(dat.ph.def$new_hname)
# trinomials & nf....
dat.ph.def$new_hname[dat.ph.def$new_hname=="Capoetobrama kuschakewitschi kuschakewitsch"] <- "Capoetobrama kuschakewitschi" 
dat.ph.def$new_hname[dat.ph.def$new_hname=="Tylosurus acus melanotus"] <- "Tylosurus acus" 
dat.ph.def$new_hname[dat.ph.def$new_hname=="Esox americanus americanus"] <- "Esox americanus" 
dat.ph.def$new_hname[dat.ph.def$new_hname=="Salvelinus leucomaenis pluvius"] <- "Salvelinus leucomaenis"
dat.ph.def$new_hname[dat.ph.def$new_hname=="nf"] <- NA

# separate out parasite traits in order to correct some errors
par.traits <- dat.ph.def %>% dplyr::select(new_pname,P_Taxon,Endoparasite,Complex,Trophic,Horizontal,Host_no) %>%  filter(!is.na(new_pname))  %>% filter(!(new_pname=="Spiracanthus bovichthys" & P_Taxon=="M")) %>% filter(!(new_pname=="Neoechinorhynchus cylindratus" & P_Taxon=="M")) %>% arrange(new_pname,Endoparasite,Complex,Trophic,Horizontal) %>% distinct(new_pname)
par.traits$Complex[as.numeric(par.traits$Host_no) > 1 & par.traits$Complex=="No"] <- NA # factor level 1 is "1"
par.traits <- par.traits %>% dplyr::select(-Host_no)


###### assume global max host size as max host size
host.traits <- dat.ph.def %>% dplyr::select(MaxL,new_hname) %>% group_by(new_hname) %>% summarize(maxL=max(MaxL,na.rm=T))

# unique host parasite lists
bipdef <- dplyr::select(dat.ph.def,new_pname,new_hname) %>% distinct() %>% arrange(new_pname,new_hname) %>% filter(!(is.na(new_pname) | is.na(new_hname)))

bipdefgeo <- dplyr::select(dat.ph.def,new_pname,new_hname,GEO) %>% distinct() %>% arrange(new_pname,new_hname) %>% filter(!(is.na(new_pname) | is.na(new_hname)))

# regroup
bipdef.traits1 <- left_join(bipdef,host.traits,by=c("new_hname"))
bipdef.traits <- left_join(bipdef.traits1,par.traits,by=c("new_pname"))

bipdefgeo.traits1 <- left_join(bipdefgeo,host.traits,by=c("new_hname"))
bipdefgeo.traits <- left_join(bipdefgeo.traits1,par.traits,by=c("new_pname"))

save(bipdef.traits,bipdefgeo.traits,file="bipdeftraits30may.Rdata")
# these files are used for calculating the metrics

```

```{r metrics,echo=FALSE,eval=FALSE}

library(ape)
library(phangorn)
library(gdata)
library(picante)

load("bipdeftraits30may.Rdata")
load('pgd_final.RData') #matrix called pgd_final

############
# FUNCTIONS
###########

calcMetrics <- function(assoc,ro_allhost_tree,pgd_final,filename) {
  cdmat <- makecdmat(assoc)
  pd_allhost <- suppressWarnings(pd(cdmat,ro_allhost_tree,include.root=FALSE)) # exclude root 
  pd_allhost$new_pname <- rownames(pd_allhost)
  save(pd_allhost,file=paste("pd",filename,sep="_"))
  gen <- calcother(assoc,pgd_final)
  generalism <- full_join(gen,pd_allhost,by="new_pname")
  save(generalism,file=filename)
  return(generalism)
}

makecdmat <- function(assoc) {
  # make a community data matrix (which is just a binary matrix to record associations - parasites as rows and hosts as columns)
  paralist <- unique(assoc$new_pname)
  hostlist <- unique(assoc$h_name)
  cdmat<-matrix(rep(0,length(paralist)*length(hostlist)),nrow=length(paralist))
  colnames(cdmat)<-hostlist
  rownames(cdmat)<-paralist
  for(paras in 1:length(paralist)){
    hlist<-assoc[assoc$new_pname==paralist[paras],"h_name"]
    cdmat[paras,intersect(hlist, hostlist)]<-1
  }
  return(cdmat)
}


hlistsum <- function(hlist,pgd_final) {
  sumPGD<-sum(pgd_final[hlist, hlist], na.rm=TRUE) # only lower triangle
  return(as.numeric(sumPGD))
  #print(sumPGD)
}

calcother <- function(assoc,pgd_final) {
  
  gen <- assoc %>% group_by(new_pname,P_Taxon,Endoparasite,Complex,Trophic,Horizontal) %>% summarize(hostN=n(),edges=(n()*(n()-1))/2,meanMaxL=mean(maxL,na.rm=T),sdMaxL=sd(maxL,na.rm=T),maxMaxL=max(maxL,na.rm=T)) 
  
  gen2 <- assoc %>% dplyr::select(-maxL,-new_hname) %>% group_by(new_pname,P_Taxon,Endoparasite,Complex,Trophic,Horizontal) %>% do({
    sumPGD <- hlistsum(.$h_name,pgd_final)
    x <- .[1,]
    x$sumPGD <- sumPGD
    return(x)
  }) %>% dplyr::select(-h_name)
  
  gen3 <- full_join(gen,gen2,by=c("new_pname","P_Taxon","Endoparasite","Complex","Trophic","Horizontal"))
  gen3$cvmaxL <- gen3$sdMaxL/gen3$meanMaxL
  gen3$SPD <- gen3$sumPGD/gen3$edges
  gen3$G <- as.numeric(gen3$hostN > 1)

  return(gen3)
}


############
# Make tree
############
# make the tree of all hosts (ultrametric using upgma)
allhost_tree<-upgma(pgd_final)
# plot(allhost_tree, show.tip.label = FALSE, direction="downwards")
# plot(allhost_tree, show.tip.label = FALSE, type="fan")
ro_allhost_tree<-reorder(allhost_tree, "cladewise")

########################
# Calculate without GEO
########################
assoc <- bipdef.traits
assoc$h_name <- gsub(" ","_",assoc$new_hname)
#paralist <- as.character(unique(assoc$new_pname))
gen.noGEO <- calcMetrics(assoc,ro_allhost_tree,pgd_final,"gen.noGEO.RData")

########################
# Calculate with GEO
########################
assocG <- bipdefgeo.traits
assocG$h_name <- gsub(" ","_",assocG$new_hname)
assocG <- unite(assocG,new_pname,new_pname,GEO,sep="_",remove=TRUE) # need to make the pname + GEO
gen.GEO <- calcMetrics(assocG,ro_allhost_tree,pgd_final,"gen.GEO.RData")
#gen.GEO.s <- separate(gen.GEO,new_pname,"new_pname","GEO",sep="_",remove=TRUE)
# think about GEO NA's

```


## Summary of Metrics Calculated
Generalism, similar to diversity, can be measured in a number of ways. Poulin et al 2011 describe four facets of generalism: basic, phylogenetic, geographic, and ontogenetic. Basic metrics are calculated from numbers of hosts, phylogenetic metrics use genetic or taxonomic distances between hosts, geographic metrics look at specificity in space, and ontogenetic metrics look at specificity between life stages of the parasite. We don't expect these different measures to be independent and they tend to be correlated with number of hosts.

The nature of the data in the fish host-parasite database, which only includes associations and not abundances or prevalences, limits the metrics which we can calculate. In addition, due to only having information on fish hosts, we can't calculate an accurate measure of intermediate host specificity, so do not calculate ontogenetic measures. We have information on geography at a large regional scale, but only a small proportion of parasites have hosts in multiple locations - instead of calculating a geographic metric, we calculate basic and phylogenetic metrics both with and without parasite-host associations divided by geographic region.

The metrics we calculate are:

| Metric | Description | Facet | Source |
|--------|-------------|-----------|-------|
|degree  | number of hosts | basic | |
|G | binary measure, G=1 if degree > 1 | basic | |
| SPD | mean pairwise phylogenetic distance between all hosts | phylogenetic | Poulin & Mouillot |
| Faith's PD | minimum total length of all the phylogenetic branches required to span all hosts on the phylogenetic tree | phylogenetic | Faith 1992 |
<!-- | PS | sum of pairwise phylogenetic distance between all hosts |phylogenetic | Poulin 2011 | -->

Both phylogenetic metrics, SPD and Faith's PD, are only calculated for parasites with more than 1 host (G=1).

## Analysis Methods
The generalism metrics for each parasite species were compared to measures of host and parasite characteristics (Table 1 in main document) for which theoretical predictions were made. 

Metrics for parasites with direct or trophic life cycles were compared to summary measures (mean, maximum, and coefficient of variation (CV)) of the maximum length reported for each of their hosts.  Note that CV of the host length is only calculated for parasites with more than one host. Endoparasites and ectoparasites were assessed separately, with an additional categorical length measure used for ectoparasites, whereby the length summary measures were divided into a categorical variable according to quartiles.

The effect of geographic region on parasites with direct or trophic life cycle was calculated for endoparasites and ectoparasites together. Regions were assessed as defined in Table 1 and also divided into two groups, where Antarctica, Nearctic, and Palearctic were assumed to be colder than Africa, Australia, Indopacific, and Neotropical regions. Some host-parasite associations were reported in more than one region, so for this analysis the generalism metrics were calculated separately for each region.

The generalism metrics each come from very different distributions, based on this GLMs were used as follows: for degree, negative binomial regression with a log link function (glm.nb() in R); for G, logistic regression (glm(family="binomial") in R); PD and SPD, linear regression (lm() in R), with PD log transformed. For lm(), assumptions of homoscedasticity and normality of residuals were assessed visually, and in some cases there was a bit of heteroscedasticity so there may be a bias in the standard error estimates, it has lower variance at higher values (but actually it has very few points at higher values, and so these have a lot of leverage in the estimates). [I considered doing bootstrapping to adjust p-values, or weighted least squares but not sure how to weight, but haven't done this...thoughts on better ways to do this analysis welcome!]

# Endo vs Ecto (Direct only)
```{r endoecto,echo=FALSE,warning=FALSE}
load("~/dat/generalismtheory/gen.noGEO.RData")
names(generalism)[17] <- c("degree")
generalism$SPD[generalism$G==0] <- 0
sps <- read.table("~/dat/generalismtheory/sps.txt",header=T)
generalism$pname <- gsub(" ","_",generalism$new_pname)
generalism2 <- left_join(generalism,sps,by="pname")

hp1 <- generalism2 %>% filter(Trophic=="No" & Complex=="No")
hp1long <- hp1 %>% gather("index","value",c(14:17,24))
hp1long %>% ggplot(data=.,aes(x=Endoparasite,y=value)) + geom_boxplot() + theme_bw() + facet_wrap(~index,scales="free") + ylab("index value") 

infD2 <- glm.nb(data=hp1,degree ~ Endoparasite) 
infG2 <- glm(data=hp1,G ~ Endoparasite,family="binomial") 
infPD2 <- lm(data=hp1,log(PD+0.01) ~ Endoparasite)
infSPD2 <- lm(data=hp1,SPD ~ Endoparasite) 
infSESPD <- lm(data=hp1,pd.obs.z ~ Endoparasite)
# not using these/not showing

# with(hp1,table(Endoparasite,Complex))
# with(generalism,table(Endoparasite,Complex))
# with(generalism,table(Endoparasite,Trophic))

```

## Endoparasites & Host Body Size
Clay's model predicts that there should be a positive correlation among parasites’ generalism metrics and both the maximum host body size and the mean and CV body size across all host species. 

For some measures we do see a positive correlation, and in particular there is a strong positive correlation between the coefficient of variation of host length and the mean phylogenetic distance between hosts (SPD).

In the plots, many of the relationships appear to be non-linear, but this is due to a few outlying points which don't have much impact on the fit. Plots are shown with loess ("locally weighted regression" smoothed lines to demonstrate the shape of the relationship). 


```{r maxl,echo=FALSE,warning=FALSE}
# load("~/dat/generalismtheory/gen.noGEO.RData")
# names(generalism)[17] <- c("degree")
# generalism$SPD[generalism$G==0] <- 0

hp.endo <- generalism2 %>% filter(Endoparasite =="Endo")
hp.endo2 <- hp.endo %>% filter(Trophic=="Yes" | Complex=="No")

# # divide into quartiles
# summean <- summary(hp.endo2$meanMaxL)
# hp.endo2$mean.lcat <- 1
# hp.endo2$mean.lcat[hp.endo2$meanMaxL > summean["1st Qu."]] <- 2
# hp.endo2$mean.lcat[hp.endo2$meanMaxL > summean["Median"]] <- 3
# hp.endo2$mean.lcat[hp.endo2$meanMaxL > summean["3rd Qu."]] <- 4
# 
# sumsd <- summary(hp.endo2$sdMaxL)
# hp.endo2$sd.lcat <- 1
# hp.endo2$sd.lcat[hp.endo2$sdMaxL > sumsd["1st Qu."]] <- 2
# hp.endo2$sd.lcat[hp.endo2$sdMaxL > sumsd["Median"]] <- 3
# hp.endo2$sd.lcat[hp.endo2$sdMaxL > sumsd["3rd Qu."]] <- 4
# 
# summax <- summary(hp.endo2$maxMaxL)
# hp.endo2$max.lcat <- 1
# hp.endo2$max.lcat[hp.endo2$maxMaxL > summax["1st Qu."]] <- 2
# hp.endo2$max.lcat[hp.endo2$maxMaxL > summax["Median"]] <- 3
# hp.endo2$max.lcat[hp.endo2$maxMaxL > summax["3rd Qu."]] <- 4
# 
# sumcv <- summary(hp.endo2$cvmaxL)
# hp.endo2$cv.lcat <- 1
# hp.endo2$cv.lcat[hp.endo2$cvmaxL > sumcv["1st Qu."]] <- 2
# hp.endo2$cv.lcat[hp.endo2$cvmaxL > sumcv["Median"]] <- 3
# hp.endo2$cv.lcat[hp.endo2$cvmaxL > sumcv["3rd Qu."]] <- 4

endoDlong <- hp.endo2 %>% gather("index","value",c(14:17,24))
#endoDlong1 <- endoDlong %>% gather("length_cat_measure","length_cat",c(13:16))
endoDlong2 <- endoDlong %>% gather("length_measure","length",c(9,11,13))

# endoDlong2 %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(index~length_measure,scales="free") + ylab("index value") + geom_smooth(method="lm")
endoDlong2$length_measure <- as.factor(endoDlong2$length_measure)
levels(endoDlong2$length_measure) <- c("CV host length", "max host length", "mean host length")
endoDlong2 %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(index~length_measure,scales="free") + ylab("index value") + geom_smooth(method="loess")

endoDlong2 %>% filter(index=="degree") %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("degree") + stat_smooth(method="glm.nb")

endoDlong2 %>% filter(index=="G",length_measure!="CV host length") %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("G") + stat_smooth(method="glm", method.args = list(family = "binomial"))

endoDlong2$log <- log(endoDlong2$value+0.01)
endoDlong2 %>% filter(index=="PD") %>% ggplot(data=.,aes(x=length,y=log)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("log PD") + stat_smooth(method="lm") 

endoDlong2 %>% filter(index=="SPD") %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("SPD") + stat_smooth(method="lm")

endoDlong2 %>% filter(index=="pd.obs.z") %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("SES.PD") + stat_smooth(method="lm")


# endoDlong2 %>% ggplot(data=.,aes(x=as.factor(length_cat),y=value)) + geom_boxplot() + theme_bw() + facet_grid(index~length_cat_measure,scales="free") + ylab("index value")
```

```{r endoanalysis, echo=FALSE,eval=TRUE,results="hide"}

endoD1 <- glm.nb(data=hp.endo2,degree ~ cvmaxL) # positive
endoD2 <- glm.nb(data=hp.endo2,degree ~ maxMaxL) # positive
endoD3 <- glm.nb(data=hp.endo2,degree ~ meanMaxL) # negative

endoG2 <- glm(data=hp.endo2,G ~ maxMaxL,family="binomial") # positive
endoG3 <- glm(data=hp.endo2,G ~ meanMaxL,family="binomial") # negative

endoPD1 <- lm(data=hp.endo2,log(PD+0.01) ~ cvmaxL) # positive
endoPD2 <- lm(data=hp.endo2,log(PD+0.01) ~ maxMaxL) # positive
endoPD3 <- lm(data=hp.endo2,log(PD+0.01) ~ meanMaxL) # negative

endoSPD1 <- lm(data=hp.endo2,SPD ~ cvmaxL) # positive
endoSPD2 <- lm(data=hp.endo2,SPD ~ maxMaxL) # no relationship
endoSPD3 <- lm(data=hp.endo2,SPD ~ meanMaxL) # negative

endoSESPD1 <- lm(data=hp.endo2,pd.obs.z ~ cvmaxL) # positive
endoSESPD2 <- lm(data=hp.endo2,pd.obs.z ~ maxMaxL) # negative
endoSESPD3 <- lm(data=hp.endo2,pd.obs.z ~ meanMaxL) # negative
```

| Metric | Length Measure | Model Coefficient | Std Error | Conf Int |
|--------|-------------|-----------|-------|-------|
| degree | mean | `r round(coef(summary(endoD3))[2,1],digits=8)` |$`r round(coef(summary(endoD3))[2,2],digits=8)`$ | `r round(confint(endoD3)[2,],digits=8)` |
| degree | max | `r round(coef(summary(endoD2))[2,1],digits=8)` |`r round(coef(summary(endoD2))[2,2],digits=8)` | `r round(confint(endoD2)[2,],digits=8)` |
| degree | CV | `r round(coef(summary(endoD1))[2,1],digits=8)` |`r round(coef(summary(endoD1))[2,2],digits=8)` | `r round(confint(endoD1)[2,],digits=8)` |
| G | mean | `r round(coef(summary(endoG3))[2,1],digits=8)` |`r round(coef(summary(endoG3))[2,2],digits=8)` | `r round(confint(endoG3)[2,],digits=8)` |
| G | max | `r round(coef(summary(endoG2))[2,1],digits=8)` |`r round(coef(summary(endoG2))[2,2],digits=8)` | `r round(confint(endoG2)[2,],digits=8)` |
| PD | mean | `r round(coef(summary(endoPD3))[2,1],digits=8)` |`r round(coef(summary(endoPD3))[2,2],digits=8)` | `r round(confint(endoPD3)[2,],digits=8)` |
| PD | max | `r round(coef(summary(endoPD2))[2,1],digits=8)` |`r round(coef(summary(endoPD2))[2,2],digits=8)` | `r round(confint(endoPD2)[2,],digits=8)` |
| PD | CV | `r round(coef(summary(endoPD1))[2,1],digits=8)` |`r round(coef(summary(endoPD1))[2,2],digits=8)` | `r round(confint(endoPD1)[2,],digits=8)` |
| SPD | mean | `r round(coef(summary(endoSPD3))[2,1],digits=8)` |`r round(coef(summary(endoSPD3))[2,2],digits=8)` | `r round(confint(endoSPD3)[2,],digits=8)` |
| SPD | max | `r round(coef(summary(endoSPD2))[2,1],digits=8)` |`r round(coef(summary(endoSPD2))[2,2],digits=8)` | `r round(confint(endoSPD2)[2,],digits=8)` |
| SPD | CV | `r round(coef(summary(endoSPD1))[2,1],digits=8)` |`r round(coef(summary(endoSPD1))[2,2],digits=8)` | `r round(confint(endoSPD1)[2,],digits=8)` |
| SESPD | mean | `r round(coef(summary(endoSESPD3))[2,1],digits=8)` |`r round(coef(summary(endoSESPD3))[2,2],digits=8)` | `r round(confint(endoSESPD3)[2,],digits=8)` |
| SESPD | max | `r round(coef(summary(endoSESPD2))[2,1],digits=8)` |`r round(coef(summary(endoSESPD2))[2,2],digits=8)` | `r round(confint(endoSESPD2)[2,],digits=8)` |
| SESPD | CV | `r round(coef(summary(endoSESPD1))[2,1],digits=8)` |`r round(coef(summary(endoSESPD1))[2,2],digits=8)` | `r round(confint(endoSESPD1)[2,],digits=8)` |


## Ectoparasites & Host Body Size
Clay's model predicts that for ectoparasites, there should be few generalist parasites of either very small bodied or very large bodied hosts.

Based on the plots, this seems to be the case for degree, PD, and PS, but not so clear for SPD. However, I categorized by quartiles and due to the skewed distribution and long tail, in some cases relatively low values for length are in the 4th quartile, for example for max length.  

```{r ecto, echo=FALSE,warning=FALSE}
hp.ecto <- generalism2 %>% filter(Endoparasite =="Ecto")
hp.ecto2 <- hp.ecto %>% filter(Trophic=="Yes" | Complex=="No") 

# divide into quartiles
summean <- summary(hp.ecto2$meanMaxL)
hp.ecto2$mean.lcat <- NA
hp.ecto2$mean.lcat[hp.ecto2$meanMaxL <= summean["1st Qu."]] <- 1
hp.ecto2$mean.lcat[hp.ecto2$meanMaxL > summean["1st Qu."]] <- 2
hp.ecto2$mean.lcat[hp.ecto2$meanMaxL > summean["Median"]] <- 3
hp.ecto2$mean.lcat[hp.ecto2$meanMaxL > summean["3rd Qu."]] <- 4

summax <- summary(hp.ecto2$maxMaxL)
hp.ecto2$max.lcat <- NA
hp.ecto2$max.lcat[hp.ecto2$maxMaxL <= summax["1st Qu."]] <- 1
hp.ecto2$max.lcat[hp.ecto2$maxMaxL > summax["1st Qu."]] <- 2
hp.ecto2$max.lcat[hp.ecto2$maxMaxL > summax["Median"]] <- 3
hp.ecto2$max.lcat[hp.ecto2$maxMaxL > summax["3rd Qu."]] <- 4

sumcv <- summary(hp.ecto2$cvmaxL)
hp.ecto2$cv.lcat <- NA
hp.ecto2$cv.lcat[hp.ecto2$cvmaxL <= sumcv["1st Qu."]] <- 1
hp.ecto2$cv.lcat[hp.ecto2$cvmaxL > sumcv["1st Qu."]] <- 2
hp.ecto2$cv.lcat[hp.ecto2$cvmaxL > sumcv["Median"]] <- 3
hp.ecto2$cv.lcat[hp.ecto2$cvmaxL > sumcv["3rd Qu."]] <- 4

ectoDlong <- hp.ecto2 %>% gather("index","value",14:17)
ectoDlong1 <- ectoDlong %>% gather("length_cat_measure","length_cat",c(23:25))
ectoDlong2 <- ectoDlong1 %>% gather("length_measure","length",c(9,11,13))


ectoDlong2$length_measure <- as.factor(ectoDlong2$length_measure)
levels(ectoDlong2$length_measure) <- c("CV host length", "max host length", "mean host length")
# ectoDlong2 %>%  ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(index~length_measure,scales="free") + ylab("index value") + geom_smooth(method="lm")

ectoDlong2 %>%  ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(index~length_measure,scales="free") + ylab("index value") + geom_smooth(method="loess")

ectoDlong2 %>% filter(index!="G") %>% ggplot(data=.,aes(x=as.factor(length_cat),y=value)) + geom_boxplot() + theme_bw() + facet_grid(index~length_cat_measure,scales="free") + ylab("index value")
#####

hp.ecto2 %>%  ggplot(data=.,aes(x=cvmaxL,fill=as.factor(cv.lcat))) + geom_histogram(bins=40) + theme_bw() #+ facet_grid(~length_measure,scales="free")
hp.ecto2 %>%  ggplot(data=.,aes(x=meanMaxL,fill=as.factor(mean.lcat))) + geom_histogram(bins=40) + theme_bw() #+ facet_grid(~length_measure,scales="free")
hp.ecto2 %>%  ggplot(data=.,aes(x=maxMaxL,fill=as.factor(max.lcat))) + geom_histogram(bins=40) + theme_bw() #+ facet_grid(~length_measure,scales="free")




```



```{r ectoanalysis, echo=FALSE,results="hide"}
ectoD1 <- glm.nb(data=hp.ecto2,degree ~ as.factor(cv.lcat)) 
ectoD2 <- glm.nb(data=hp.ecto2,degree ~ as.factor(max.lcat)) 
ectoD3 <- glm.nb(data=hp.ecto2,degree ~ as.factor(mean.lcat)) 

ectoG2 <- glm(data=hp.ecto2,G ~ as.factor(max.lcat),family="binomial") 
ectoG3 <- glm(data=hp.ecto2,G ~ as.factor(mean.lcat),family="binomial") 

ectoPD1 <- lm(data=hp.ecto2,log(PD+0.01) ~ as.factor(cv.lcat)) 
ectoPD2 <- lm(data=hp.ecto2,log(PD+0.01) ~ as.factor(max.lcat)) 
ectoPD3 <- lm(data=hp.ecto2,log(PD+0.01) ~ as.factor(mean.lcat)) 

ectoSPD1 <- lm(data=hp.ecto2,SPD ~ as.factor(cv.lcat)) 
ectoSPD2 <- lm(data=hp.ecto2,SPD ~ as.factor(max.lcat)) 
ectoSPD3 <- lm(data=hp.ecto2,SPD ~ as.factor(mean.lcat)) 

ectoSESPD1 <- lm(data=hp.ecto2,pd.obs.z ~ as.factor(cv.lcat)) 
ectoSESPD2 <- lm(data=hp.ecto2,pd.obs.z ~ as.factor(max.lcat)) 
ectoSESPD3 <- lm(data=hp.ecto2,pd.obs.z ~ as.factor(mean.lcat)) 

```

| Metric | Length Measure | Quartile (ref=1) | Model Coefficient | Std Error | Conf Int |
|--------|-------------|-----------|-------|--------|--------|
| degree | mean | 2 | `r round(coef(summary(ectoD3))[2,1],digits=8)` |`r round(coef(summary(ectoD3))[2,2],digits=8)` | `r round(confint(ectoD3)[2,],digits=8)` |
| degree | mean | 3 | `r round(coef(summary(ectoD3))[3,1],digits=8)` |`r round(coef(summary(ectoD3))[3,2],digits=8)` | `r round(confint(ectoD3)[3,],digits=8)` |
| degree | mean | 4 | `r round(coef(summary(ectoD3))[4,1],digits=8)` |`r round(coef(summary(ectoD3))[4,2],digits=8)` | `r round(confint(ectoD3)[4,],digits=8)` |
| degree | max | 2 | `r round(coef(summary(ectoD2))[2,1],digits=8)` |`r round(coef(summary(ectoD2))[2,2],digits=8)` | `r round(confint(ectoD2)[2,],digits=8)` |
| degree | max | 3 | `r round(coef(summary(ectoD2))[3,1],digits=8)` |`r round(coef(summary(ectoD2))[3,2],digits=8)` | `r round(confint(ectoD2)[3,],digits=8)` |
| degree | max | 4 | `r round(coef(summary(ectoD2))[4,1],digits=8)` |`r round(coef(summary(ectoD2))[4,2],digits=8)` | `r round(confint(ectoD2)[4,],digits=8)` |
| degree | CV | 2 | `r round(coef(summary(ectoD1))[2,1],digits=8)` |`r round(coef(summary(ectoD1))[2,2],digits=8)` | `r round(confint(ectoD1)[2,],digits=8)` |
| degree | CV | 3 | `r round(coef(summary(ectoD1))[3,1],digits=8)` |`r round(coef(summary(ectoD1))[3,2],digits=8)` | `r round(confint(ectoD1)[3,],digits=8)` |
| degree | CV | 4 | `r round(coef(summary(ectoD1))[4,1],digits=8)` |`r round(coef(summary(ectoD1))[4,2],digits=8)` | `r round(confint(ectoD1)[4,],digits=8)` |
| G | mean | 2 | `r round(coef(summary(ectoG3))[2,1],digits=8)` |`r round(coef(summary(ectoG3))[2,2],digits=8)` | `r round(confint(ectoG3)[2,],digits=8)` |
| G | mean | 3 | `r round(coef(summary(ectoG3))[3,1],digits=8)` |`r round(coef(summary(ectoG3))[3,2],digits=8)` | `r round(confint(ectoG3)[3,],digits=8)` |
| G | mean | 4 | `r round(coef(summary(ectoG3))[4,1],digits=8)` |`r round(coef(summary(ectoG3))[4,2],digits=8)` | `r round(confint(ectoG3)[4,],digits=8)` |
| G | max | 2 | `r round(coef(summary(ectoG2))[2,1],digits=8)` |`r round(coef(summary(ectoG2))[2,2],digits=8)` | `r round(confint(ectoG2)[2,],digits=8)` |
| G | max | 3 | `r round(coef(summary(ectoG2))[3,1],digits=8)` |`r round(coef(summary(ectoG2))[3,2],digits=8)` | `r round(confint(ectoG2)[3,],digits=8)` |
| G | max | 4 | `r round(coef(summary(ectoG2))[4,1],digits=8)` |`r round(coef(summary(ectoG2))[4,2],digits=8)` | `r round(confint(ectoG2)[4,],digits=8)` |
| PD | mean | 2 | `r round(coef(summary(ectoPD3))[2,1],digits=8)` |`r round(coef(summary(ectoPD3))[2,2],digits=8)` | `r round(confint(ectoPD3)[2,],digits=8)` |
| PD | mean | 3 | `r round(coef(summary(ectoPD3))[3,1],digits=8)` |`r round(coef(summary(ectoPD3))[3,2],digits=8)` | `r round(confint(ectoPD3)[3,],digits=8)` |
| PD | mean | 4 | `r round(coef(summary(ectoPD3))[4,1],digits=8)` |`r round(coef(summary(ectoPD3))[4,2],digits=8)` | `r round(confint(ectoPD3)[4,],digits=8)` |
| PD | max | 2 | `r round(coef(summary(ectoPD2))[2,1],digits=8)` |`r round(coef(summary(ectoPD2))[2,2],digits=8)` | `r round(confint(ectoPD2)[2,],digits=8)` |
| PD | max | 3 | `r round(coef(summary(ectoPD2))[3,1],digits=8)` |`r round(coef(summary(ectoPD2))[3,2],digits=8)` | `r round(confint(ectoPD2)[3,],digits=8)` |
| PD | max | 4 | `r round(coef(summary(ectoPD2))[4,1],digits=8)` |`r round(coef(summary(ectoPD2))[4,2],digits=8)` | `r round(confint(ectoPD2)[4,],digits=8)` |
| PD | CV | 2 | `r round(coef(summary(ectoPD1))[2,1],digits=8)` |`r round(coef(summary(ectoPD1))[2,2],digits=8)` | `r round(confint(ectoPD1)[2,],digits=8)` |
| PD | CV | 3 | `r round(coef(summary(ectoPD1))[3,1],digits=8)` |`r round(coef(summary(ectoPD1))[3,2],digits=8)` | `r round(confint(ectoPD1)[3,],digits=8)` |
| PD | CV | 4 | `r round(coef(summary(ectoPD1))[4,1],digits=8)` |`r round(coef(summary(ectoPD1))[4,2],digits=8)` | `r round(confint(ectoPD1)[4,],digits=8)` |
| SPD | mean | 2 | `r round(coef(summary(ectoSPD3))[2,1],digits=8)` |`r round(coef(summary(ectoSPD3))[2,2],digits=8)` | `r round(confint(ectoSPD3)[2,],digits=8)` |
| SPD | mean | 3 | `r round(coef(summary(ectoSPD3))[3,1],digits=8)` |`r round(coef(summary(ectoSPD3))[3,2],digits=8)` | `r round(confint(ectoSPD3)[3,],digits=8)` |
| SPD | mean | 4 | `r round(coef(summary(ectoSPD3))[4,1],digits=8)` |`r round(coef(summary(ectoSPD3))[4,2],digits=8)` | `r round(confint(ectoSPD3)[4,],digits=8)` |
| SPD | max | 2 | `r round(coef(summary(ectoSPD2))[2,1],digits=8)` |`r round(coef(summary(ectoSPD2))[2,2],digits=8)` | `r round(confint(ectoSPD2)[2,],digits=8)` |
| SPD | max | 3 | `r round(coef(summary(ectoSPD2))[3,1],digits=8)` |`r round(coef(summary(ectoSPD2))[3,2],digits=8)` | `r round(confint(ectoSPD2)[3,],digits=8)` |
| SPD | max | 4 | `r round(coef(summary(ectoSPD2))[4,1],digits=8)` |`r round(coef(summary(ectoSPD2))[4,2],digits=8)` | `r round(confint(ectoSPD2)[4,],digits=8)` |
| SPD | CV | 2 | `r round(coef(summary(ectoSPD1))[2,1],digits=8)` |`r round(coef(summary(ectoSPD1))[2,2],digits=8)` | `r round(confint(ectoSPD1)[2,],digits=8)` |
| SPD | CV | 3 | `r round(coef(summary(ectoSPD1))[3,1],digits=8)` |`r round(coef(summary(ectoSPD1))[3,2],digits=8)` | `r round(confint(ectoSPD1)[3,],digits=8)` |
| SPD | CV | 4 | `r round(coef(summary(ectoSPD1))[4,1],digits=8)` |`r round(coef(summary(ectoSPD1))[4,2],digits=8)` | `r round(confint(ectoSPD1)[4,],digits=8)` |
| SESPD | mean | 2 | `r round(coef(summary(ectoSESPD3))[2,1],digits=8)` |`r round(coef(summary(ectoSESPD3))[2,2],digits=8)` | `r round(confint(ectoSESPD3)[2,],digits=8)` |
| SESPD | mean | 3 | `r round(coef(summary(ectoSESPD3))[3,1],digits=8)` |`r round(coef(summary(ectoSESPD3))[3,2],digits=8)` | `r round(confint(ectoSESPD3)[3,],digits=8)` |
| SESPD | mean | 4 | `r round(coef(summary(ectoSESPD3))[4,1],digits=8)` |`r round(coef(summary(ectoSESPD3))[4,2],digits=8)` | `r round(confint(ectoSESPD3)[4,],digits=8)` |
| SESPD | max | 2 | `r round(coef(summary(ectoSESPD2))[2,1],digits=8)` |`r round(coef(summary(ectoSESPD2))[2,2],digits=8)` | `r round(confint(ectoSESPD2)[2,],digits=8)` |
| SESPD | max | 3 | `r round(coef(summary(ectoSESPD2))[3,1],digits=8)` |`r round(coef(summary(ectoSESPD2))[3,2],digits=8)` | `r round(confint(ectoSESPD2)[3,],digits=8)` |
| SESPD | max | 4 | `r round(coef(summary(ectoSESPD2))[4,1],digits=8)` |`r round(coef(summary(ectoSESPD2))[4,2],digits=8)` | `r round(confint(ectoSESPD2)[4,],digits=8)` |
| SESPD | CV | 2 | `r round(coef(summary(ectoSESPD1))[2,1],digits=8)` |`r round(coef(summary(ectoSESPD1))[2,2],digits=8)` | `r round(confint(ectoSESPD1)[2,],digits=8)` |
| SESPD | CV | 3 | `r round(coef(summary(ectoSESPD1))[3,1],digits=8)` |`r round(coef(summary(ectoSESPD1))[3,2],digits=8)` | `r round(confint(ectoSESPD1)[3,],digits=8)` |
| SESPD | CV | 4 | `r round(coef(summary(ectoSESPD1))[4,1],digits=8)` |`r round(coef(summary(ectoSESPD1))[4,2],digits=8)` | `r round(confint(ectoSESPD1)[4,],digits=8)` |



## Temperature (Region) and Generalism
Clay's model predicts that generalists are more likely in cooler temperatures. Our measure of temperature based on region here is very, very rough. We see higher degree in cool regions, but slightly lower phylogenetic generalism. Could this be because of confounding with available hosts and higher host diversity in warm regions?


```{r geo, echo=FALSE,warning=FALSE}
# Use alternative index calculated with GEO
load("~/dat/generalismtheory/gen.GEO.RData")
generalismGEO <- data.frame(generalism) %>% separate(new_pname,into=c("pname","GEO"),sep="_",remove=FALSE)
generalismGEO$new_pname <- gsub(" ","_",generalismGEO$new_pname)
names(generalismGEO)[19] <- "degree"
generalismGEO$GEO[generalismGEO$GEO=="NA"] <- NA
generalismGEO$SPD[generalismGEO$G==0] <- 0
sps.geo <- read.table("~/dat/generalismtheory/sps_geo.txt",header=T)
generalismGEO2 <- left_join(generalismGEO,sps.geo,by=c("new_pname"="pname"))

hp.geoDirect <- generalismGEO2 %>% filter(Trophic=="Yes" | Complex=="No")
hp.geoDirect$GeoGroup <- NA
hp.geoDirect$GeoGroup[hp.geoDirect$GEO %in% c("AFR","AUS","IND","NEO")] <- "warm"
hp.geoDirect$GeoGroup[hp.geoDirect$GEO %in% c("ANT","NEA","PAL")] <- "cool"
hp.geoDirect$GeoGroup = factor(hp.geoDirect$GeoGroup,levels(factor(hp.geoDirect$GeoGroup))[c(2,1)])
hp.geoDirect$GEO = factor(hp.geoDirect$GEO,levels(factor(hp.geoDirect$GEO))[c(1,3,4,6,2,5,7)])

geoDlong <- hp.geoDirect %>% gather("index","value",c(16:19,25))
geoDlong %>% filter(!is.na(GEO)) %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_wrap(~index,scales="free") 
geoDlong %>% filter(!is.na(GeoGroup)) %>% ggplot(data=.,aes(x=GeoGroup,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_wrap(~index,scales="free") 

geoDlong %>% filter(!is.na(GeoGroup) & index!="G") %>% ggplot(data=.,aes(x=GeoGroup,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_wrap(~index,scales="free") + theme(legend.position="none")


```


```{r geoanalysis, echo=FALSE,results="hide"}
# geoD <- glm.nb(data=hp.geoDirect,degree ~ GEO) 
# geoG <- glm(data=hp.geoDirect,G ~ GEO,family="binomial") 
# geoPD <- lm(data=hp.geoDirect,log(PD+0.01) ~ GEO)
# geoSPD <- lm(data=hp.geoDirect,SPD ~ GEO) 
geoD2 <- glm.nb(data=hp.geoDirect,degree ~ GeoGroup) 
geoG2 <- glm(data=hp.geoDirect,G ~ GeoGroup,family="binomial") 
geoPD2 <- lm(data=hp.geoDirect,log(PD+0.01) ~ GeoGroup)
geoSPD2 <- lm(data=hp.geoDirect,SPD ~ GeoGroup) 
geoSESPD2 <- lm(data=hp.geoDirect,pd.obs.z ~ GeoGroup) 
```

| Metric | Model Coefficient (ref="warm") | Std Error | Conf Int |
|--------|-----------|-------|------|
| degree |  `r round(coef(summary(geoD2))[2,1],digits=8)` |`r round(coef(summary(geoD2))[2,2],digits=8)` | `r round(confint(geoD2)[2,],digits=8)` | 
| G |  `r round(coef(summary(geoG2))[2,1],digits=8)` |`r round(coef(summary(geoG2))[2,2],digits=8)` | `r round(confint(geoG2)[2,],digits=8)` |
| PD |  `r round(coef(summary(geoPD2))[2,1],digits=8)` |`r round(coef(summary(geoPD2))[2,2],digits=8)` | `r round(confint(geoPD2)[2,],digits=8)` |
| SPD |  `r round(coef(summary(geoSPD2))[2,1],digits=8)` |`r round(coef(summary(geoSPD2))[2,2],digits=8)` | `r round(confint(geoSPD2)[2,],digits=8)` |
| SESPD |  `r round(coef(summary(geoSESPD2))[2,1],digits=8)` |`r round(coef(summary(geoSESPD2))[2,2],digits=8)` | `r round(confint(geoSESPD2)[2,],digits=8)` |

# Not including this:
## Trophic Transmission
Amy  H's model predicts that parasites with trophic transmission are less likely to be generalists, but we see the opposite pattern in this data.

```{r trophic,echo=FALSE,warning=FALSE}
load("~/dat/generalismtheory/gen.noGEO.RData")
names(generalism)[17] <- c("degree")
hp.trop <- generalism %>% filter(Trophic == "Yes" | Trophic=="No") 
troplong <- hp.trop %>% gather("index","value",14:17) 

troplong %>% ggplot(data=.,aes(x=Trophic,y=value)) + geom_violin() + theme_bw() + facet_wrap(~index,scales="free") 
```

```{r trophicanalysis, echo=FALSE,results="hide"}
tropD <- glm.nb(data=hp.trop,degree ~ Trophic) 
tropG <- glm(data=hp.trop,G ~ Trophic,family="binomial") 
tropPD <- lm(data=hp.trop,log(PD+0.01) ~ Trophic)
tropSPD <- lm(data=hp.trop,SPD ~ Trophic) 

```

| Metric | Model Coefficient (ref="No") | Std Error |
|--------|-----------|-------|
| degree |  $`r round(coef(summary(tropD))[2,1],digits=8)`$ |`r round(coef(summary(tropD))[2,2],digits=8)` |
| G |  `r round(coef(summary(tropG))[2,1],digits=8)` |`r round(coef(summary(tropG))[2,2],digits=8)` |
| PD |  `r round(coef(summary(tropPD))[2,1],digits=8)` |`r round(coef(summary(tropPD))[2,2],digits=8)` |
| SPD |  `r round(coef(summary(tropSPD))[2,1],digits=8)` |`r round(coef(summary(tropSPD))[2,2],digits=8)` |



# New plots 19 July 2016: Combine endo and ecto and look at difference between direct and trophic
## Direct Life Cycles and body size metrics
The first plot where all the metrics are together has a loess smoothed line, the others have model fit lines that match the statistical analysis. 

```{r newplots,echo=FALSE,warning=FALSE}
hp.direct <- generalism2 %>% filter(Complex == "No" & Trophic=="No")
hp.trophic <- generalism2 %>% filter(Trophic == "Yes")
directlong <- hp.direct %>% gather("index","value",c(14:17,24))
directlong2 <- directlong %>%  gather("length_measure","length",c(9,11,13))
trophiclong <- hp.trophic %>% gather("index","value",c(14:17,24))
trophiclong2 <- trophiclong %>%  gather("length_measure","length",c(9,11,13))

directlong2$length_measure <- as.factor(directlong2$length_measure)
levels(directlong2$length_measure) <- c("CV host length", "max host length", "mean host length")
directlong2$length_measure <- relevel(directlong2$length_measure,ref="mean host length")
directlong2$length_measure <- relevel(directlong2$length_measure,ref="max host length")
# directlong2 %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(index~length_measure,scales="free") + ylab("index value") + geom_smooth(method="loess")


plotd <- directlong2 %>% filter(index=="degree") %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("degree") + stat_smooth(method="glm.nb") + xlab(NULL)


# don't need this... just use geom_count()
# # bin results by length
# bin <- function(val) {
#   xx <- data.frame(x=seq(5,795,by=10),min=seq(0,790,by=10), max=seq(10,800,by=10))
#   if(!is.na(val)) {
#   b <- xx$x[(val > xx$min & val <= xx$max)]
#   return(b)
#   }
#   else {return(NA)}
# }
# 
# newg <- directlong2 %>% filter(index=="G",length_measure!="CV host length") 
# newg <- newg[,c(4,5,19:22)]
# newg$lengthbin <- unlist(lapply(newg$length,bin))
# newg2 <- newg %>% group_by(Complex,Trophic,index,value,length_measure, lengthbin) %>% summarize(z=n())
#   
# plotg <- newg2 %>% filter(index=="G",length_measure!="CV host length") %>% ggplot(data=.,aes(x=lengthbin,y=value,size=z)) + geom_point() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("G") + stat_smooth(method="glm", method.args = list(family = "binomial"))

plotg <- directlong2 %>% filter(index=="G",length_measure!="CV host length") %>% ggplot(data=.,aes(x=length,y=value)) + geom_count()  + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("G") + stat_smooth(method="glm", method.args = list(family = "binomial")) + theme(legend.position="right") + xlab(NULL) #+ geom_density_2d() + geom_count() + geom_bin2d()

# directlong2$log <- log(directlong2$value+0.01)
# directlong2 %>% filter(index=="PD") %>% ggplot(data=.,aes(x=length,y=log)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("log PD") + stat_smooth(method="lm") 

plotspd <- directlong2 %>% filter(index=="SPD") %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("SPD") + stat_smooth(method="lm") + xlab(NULL)

plotsespd <- directlong2 %>% filter(index=="pd.obs.z") %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("SES.PD") + stat_smooth(method="lm") + xlab("Length metric")

# grid with degree, G, SPD, and SES-PD
library(gridExtra)
lay=rbind(c(1,1,1,1,1,1),c(2,2,2,2,2,NA),c(3,3,3,3,3,3),c(4,4,4,4,4,4))
grid.arrange(plotd,plotg,plotspd,plotsespd,layout_matrix=lay)

jpeg("~/dat/generalismtheory/direct1.jpeg")
grid.arrange(plotd,plotg,plotspd,plotsespd,layout_matrix=lay)
dev.off()

pdf("~/dat/generalismtheory/direct1.pdf")
grid.arrange(plotd,plotg,plotspd,plotsespd,layout_matrix=lay)
dev.off()

```

```{r directanalysis, echo=FALSE,eval=TRUE,results="hide"}

directD1 <- glm.nb(data=hp.direct,degree ~ cvmaxL) # positive
directD2 <- glm.nb(data=hp.direct,degree ~ maxMaxL) # positive
directD3 <- glm.nb(data=hp.direct,degree ~ meanMaxL) # negative

directG2 <- glm(data=hp.direct,G ~ maxMaxL,family="binomial") # positive
directG3 <- glm(data=hp.direct,G ~ meanMaxL,family="binomial") # negative

# directPD1 <- lm(data=hp.direct,log(PD+0.01) ~ cvmaxL) # positive
# directPD2 <- lm(data=hp.direct,log(PD+0.01) ~ maxMaxL) # positive
# directPD3 <- lm(data=hp.direct,log(PD+0.01) ~ meanMaxL) # negative

directSPD1 <- lm(data=hp.direct,SPD ~ cvmaxL) # positive
directSPD2 <- lm(data=hp.direct,SPD ~ maxMaxL) # no relationship
directSPD3 <- lm(data=hp.direct,SPD ~ meanMaxL) # negative

directSESPD1 <- lm(data=hp.direct,pd.obs.z ~ cvmaxL) # positive
directSESPD2 <- lm(data=hp.direct,pd.obs.z ~ maxMaxL) # negative
directSESPD3 <- lm(data=hp.direct,pd.obs.z ~ meanMaxL) # negative
```

| Metric | Length Measure | Model Coefficient | Std Error | Conf Int | Z-score |
|--------|-------------|-----------|-------|-------|-----|
| degree | mean | `r round(coef(summary(directD3))[2,1],digits=8)` |$`r round(coef(summary(directD3))[2,2],digits=8)`$ | `r round(confint(directD3)[2,],digits=8)` | `r round(coef(summary(directD3))[2,3],digits=8)` |
| degree | max | `r round(coef(summary(directD2))[2,1],digits=8)` |`r round(coef(summary(directD2))[2,2],digits=8)` | `r round(confint(directD2)[2,],digits=8)` | `r round(coef(summary(directD2))[2,3],digits=8)` |
| degree | CV | `r round(coef(summary(directD1))[2,1],digits=8)` |`r round(coef(summary(directD1))[2,2],digits=8)` | `r round(confint(directD1)[2,],digits=8)` | `r round(coef(summary(directD1))[2,3],digits=8)` |
| G | mean | `r round(coef(summary(directG3))[2,1],digits=8)` |`r round(coef(summary(directG3))[2,2],digits=8)` | `r round(confint(directG3)[2,],digits=8)` | `r round(coef(summary(directG3))[2,3],digits=8)` |
| G | max | `r round(coef(summary(directG2))[2,1],digits=8)` |`r round(coef(summary(directG2))[2,2],digits=8)` | `r round(confint(directG2)[2,],digits=8)` | `r round(coef(summary(directG2))[2,3],digits=8)` |
| SPD | mean | `r round(coef(summary(directSPD3))[2,1],digits=8)` |`r round(coef(summary(directSPD3))[2,2],digits=8)` | `r round(confint(directSPD3)[2,],digits=8)` | `r round(coef(summary(directSPD3))[2,3],digits=8)` |
| SPD | max | `r round(coef(summary(directSPD2))[2,1],digits=8)` |`r round(coef(summary(directSPD2))[2,2],digits=8)` | `r round(confint(directSPD2)[2,],digits=8)` | `r round(coef(summary(directSPD2))[2,3],digits=8)` |
| SPD | CV | `r round(coef(summary(directSPD1))[2,1],digits=8)` |`r round(coef(summary(directSPD1))[2,2],digits=8)` | `r round(confint(directSPD1)[2,],digits=8)` | `r round(coef(summary(directSPD1))[2,3],digits=8)` |
| SESPD | mean | `r round(coef(summary(directSESPD3))[2,1],digits=8)` |`r round(coef(summary(directSESPD3))[2,2],digits=8)` | `r round(confint(directSESPD3)[2,],digits=8)` | `r round(coef(summary(directSESPD3))[2,3],digits=8)` |
| SESPD | max | `r round(coef(summary(directSESPD2))[2,1],digits=8)` |`r round(coef(summary(directSESPD2))[2,2],digits=8)` | `r round(confint(directSESPD2)[2,],digits=8)` | `r round(coef(summary(directSESPD2))[2,3],digits=8)` |
| SESPD | CV | `r round(coef(summary(directSESPD1))[2,1],digits=8)` |`r round(coef(summary(directSESPD1))[2,2],digits=8)` | `r round(confint(directSESPD1)[2,],digits=8)` | `r round(coef(summary(directSESPD1))[2,3],digits=8)` |


## Trophic Life Cycles and body size metrics
The first plot where all the metrics are together has a loess smoothed line, the others have model fit lines that match the statistical analysis. 

```{r newplots2,echo=FALSE,warning=FALSE}
trophiclong2$length_measure <- as.factor(trophiclong2$length_measure)
levels(trophiclong2$length_measure) <- c("CV host length", "max host length", "mean host length")
trophiclong2$length_measure <- relevel(trophiclong2$length_measure,ref="mean host length")
trophiclong2$length_measure <- relevel(trophiclong2$length_measure,ref="max host length")
# trophiclong2 %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(index~length_measure,scales="free") + ylab("index value") + geom_smooth(method="loess")

plotdt <- trophiclong2 %>% filter(index=="degree") %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("degree") + stat_smooth(method="glm.nb") +xlab(NULL)

plotgt <- trophiclong2 %>% filter(index=="G",length_measure!="CV host length") %>% ggplot(data=.,aes(x=length,y=value)) + geom_count() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("G") + stat_smooth(method="glm", method.args = list(family = "binomial")) + xlab(NULL)

# trophiclong2$log <- log(trophiclong2$value+0.01)
# trophiclong2 %>% filter(index=="PD") %>% ggplot(data=.,aes(x=length,y=log)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("log PD") + stat_smooth(method="lm") 

plotspdt <- trophiclong2 %>% filter(index=="SPD") %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("SPD") + stat_smooth(method="lm") + xlab(NULL)

plotsespdt <- trophiclong2 %>% filter(index=="pd.obs.z") %>% ggplot(data=.,aes(x=length,y=value)) + geom_jitter() + theme_bw() + facet_grid(~length_measure,scales="free") + ylab("SES.PD") + stat_smooth(method="lm") + xlab("Length metric")

grid.arrange(plotdt,plotgt,plotspdt,plotsespdt,layout_matrix=lay)

jpeg("~/dat/generalismtheory/trophic1.jpeg")
grid.arrange(plotdt,plotgt,plotspdt,plotsespdt,layout_matrix=lay)
dev.off()

pdf("~/dat/generalismtheory/trophic1.pdf")
grid.arrange(plotdt,plotgt,plotspdt,plotsespdt,layout_matrix=lay)
dev.off()

```

```{r trophicanalysis_new, echo=FALSE,eval=TRUE,results="hide"}

trophicD1 <- glm.nb(data=hp.trophic,degree ~ cvmaxL) # positive
trophicD2 <- glm.nb(data=hp.trophic,degree ~ maxMaxL) # positive
trophicD3 <- glm.nb(data=hp.trophic,degree ~ meanMaxL) # negative

trophicG2 <- glm(data=hp.trophic,G ~ maxMaxL,family="binomial") # positive
trophicG3 <- glm(data=hp.trophic,G ~ meanMaxL,family="binomial") # negative

# trophicPD1 <- lm(data=hp.trophic,log(PD+0.01) ~ cvmaxL) # positive
# trophicPD2 <- lm(data=hp.trophic,log(PD+0.01) ~ maxMaxL) # positive
# trophicPD3 <- lm(data=hp.trophic,log(PD+0.01) ~ meanMaxL) # negative

trophicSPD1 <- lm(data=hp.trophic,SPD ~ cvmaxL) # positive
trophicSPD2 <- lm(data=hp.trophic,SPD ~ maxMaxL) # no relationship
trophicSPD3 <- lm(data=hp.trophic,SPD ~ meanMaxL) # negative

trophicSESPD1 <- lm(data=hp.trophic,pd.obs.z ~ cvmaxL) # positive
trophicSESPD2 <- lm(data=hp.trophic,pd.obs.z ~ maxMaxL) # negative
trophicSESPD3 <- lm(data=hp.trophic,pd.obs.z ~ meanMaxL) # negative
```

| Metric | Length Measure | Model Coefficient | Std Error | Conf Int | Z-score |
|--------|-------------|-----------|-------|-------|-----|
| degree | mean | `r round(coef(summary(trophicD3))[2,1],digits=8)` |$`r round(coef(summary(trophicD3))[2,2],digits=8)`$ | `r round(confint(trophicD3)[2,],digits=8)` | `r round(coef(summary(trophicD3))[2,3],digits=8)` |
| degree | max | `r round(coef(summary(trophicD2))[2,1],digits=8)` |`r round(coef(summary(trophicD2))[2,2],digits=8)` | `r round(confint(trophicD2)[2,],digits=8)` | `r round(coef(summary(trophicD2))[2,3],digits=8)` |
| degree | CV | `r round(coef(summary(trophicD1))[2,1],digits=8)` |`r round(coef(summary(trophicD1))[2,2],digits=8)` | `r round(confint(trophicD1)[2,],digits=8)` | `r round(coef(summary(trophicD1))[2,3],digits=8)` |
| G | mean | `r round(coef(summary(trophicG3))[2,1],digits=8)` |`r round(coef(summary(trophicG3))[2,2],digits=8)` | `r round(confint(trophicG3)[2,],digits=8)` | `r round(coef(summary(trophicG3))[2,3],digits=8)` |
| G | max | `r round(coef(summary(trophicG2))[2,1],digits=8)` |`r round(coef(summary(trophicG2))[2,2],digits=8)` | `r round(confint(trophicG2)[2,],digits=8)` | `r round(coef(summary(trophicG2))[2,3],digits=8)` |
| SPD | mean | `r round(coef(summary(trophicSPD3))[2,1],digits=8)` |`r round(coef(summary(trophicSPD3))[2,2],digits=8)` | `r round(confint(trophicSPD3)[2,],digits=8)` | `r round(coef(summary(trophicSPD3))[2,3],digits=8)` |
| SPD | max | `r round(coef(summary(trophicSPD2))[2,1],digits=8)` |`r round(coef(summary(trophicSPD2))[2,2],digits=8)` | `r round(confint(trophicSPD2)[2,],digits=8)` | `r round(coef(summary(trophicSPD2))[2,3],digits=8)` |
| SPD | CV | `r round(coef(summary(trophicSPD1))[2,1],digits=8)` |`r round(coef(summary(trophicSPD1))[2,2],digits=8)` | `r round(confint(trophicSPD1)[2,],digits=8)` | `r round(coef(summary(trophicSPD1))[2,3],digits=8)` |
| SESPD | mean | `r round(coef(summary(trophicSESPD3))[2,1],digits=8)` |`r round(coef(summary(trophicSESPD3))[2,2],digits=8)` | `r round(confint(trophicSESPD3)[2,],digits=8)` | `r round(coef(summary(trophicSESPD3))[2,3],digits=8)` |
| SESPD | max | `r round(coef(summary(trophicSESPD2))[2,1],digits=8)` |`r round(coef(summary(trophicSESPD2))[2,2],digits=8)` | `r round(confint(trophicSESPD2)[2,],digits=8)` | `r round(coef(summary(trophicSESPD2))[2,3],digits=8)` |
| SESPD | CV | `r round(coef(summary(trophicSESPD1))[2,1],digits=8)` |`r round(coef(summary(trophicSESPD1))[2,2],digits=8)` | `r round(confint(trophicSESPD1)[2,],digits=8)` | `r round(coef(summary(trophicSESPD1))[2,3],digits=8)` |

## Direct life cycle and geographic region
```{r geodirect_new, echo=FALSE}
hp.geoDirect <- generalismGEO2 %>% filter(Trophic=="Yes" | Complex=="No")
hp.geoDirect$GeoGroup <- NA
hp.geoDirect$GeoGroup[hp.geoDirect$GEO %in% c("AFR","AUS","IND","NEO")] <- "warm"
hp.geoDirect$GeoGroup[hp.geoDirect$GEO %in% c("ANT","NEA","PAL")] <- "cool"
hp.geoDirect$GeoGroup = factor(hp.geoDirect$GeoGroup,levels(factor(hp.geoDirect$GeoGroup))[c(2,1)])
hp.geoDirect$GEO = factor(hp.geoDirect$GEO,levels(factor(hp.geoDirect$GEO))[c(1,3,4,6,2,5,7)])

hp.geoDirect2 <- hp.geoDirect %>% filter(Complex == "No" & Trophic=="No")
hp.geoDirect2$SES.PD <- hp.geoDirect2$pd.obs.z
geoDlong <- hp.geoDirect2 %>% gather("index","value",c(16:19,29))

# geoDlong %>% filter(!is.na(GEO)) %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_grid(index~.,scales="free") + xlab("Geographic region") + ylab("Generalism metric")

d <- geoDlong %>% filter(!is.na(GEO) & index=="degree") %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + xlab(NULL) + ylab("degree") + theme(legend.position="none") #+ facet_grid(index~.,scales="free") 

g <- geoDlong %>% filter(!is.na(GEO) & index=="G") %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_count() + theme_bw() + xlab(NULL) + ylab("G") + theme(legend.position="none")
# geoDlong %>% filter(!is.na(GeoGroup)) %>% ggplot(data=.,aes(x=GeoGroup,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_wrap(~index,scales="free") 
spd <- geoDlong %>% filter(!is.na(GEO) & index=="SPD") %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + xlab(NULL) + ylab("SPD") + theme(legend.position="none") #+ facet_grid(index~.,scales="free") 
sespd <- geoDlong %>% filter(!is.na(GEO) & index=="SES.PD") %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + xlab("Geographic region") + ylab("SES.PD") + theme(legend.position="none") #+ facet_grid(index~.,scales="free") 

# lay=rbind(c(1),c(1),c(1),c(1),c(2))
grid.arrange(d,g,spd,sespd,ncol=1)

# geoDlong %>% filter(!is.na(GeoGroup) & index!="G") %>% ggplot(data=.,aes(x=GeoGroup,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_wrap(~index,scales="free") + theme(legend.position="none")

jpeg("~/dat/generalismtheory/direct2.jpeg")
grid.arrange(d,g,spd,sespd,ncol=1)
dev.off()

pdf("~/dat/generalismtheory/direct2.pdf")
grid.arrange(d,g,spd,sespd,ncol=1)
dev.off()

```

```{r geoanalysis_direct, echo=FALSE,results="hide"}
# geoD <- glm.nb(data=hp.geoDirect,degree ~ GEO) 
# geoG <- glm(data=hp.geoDirect,G ~ GEO,family="binomial") 
# geoPD <- lm(data=hp.geoDirect,log(PD+0.01) ~ GEO)
# geoSPD <- lm(data=hp.geoDirect,SPD ~ GEO) 
geoD2 <- glm.nb(data=hp.geoDirect2,degree ~ GeoGroup) 
geoG2 <- glm(data=hp.geoDirect2,G ~ GeoGroup,family="binomial") 
geoPD2 <- lm(data=hp.geoDirect2,log(PD+0.01) ~ GeoGroup)
geoSPD2 <- lm(data=hp.geoDirect2,SPD ~ GeoGroup) 
geoSESPD2 <- lm(data=hp.geoDirect2,pd.obs.z ~ GeoGroup) 
```

| Metric | Model Coefficient (ref="warm") | Std Error | Conf Int | Z-score |
|--------|-----------|-------|------|-----|
| degree |  `r round(coef(summary(geoD2))[2,1],digits=8)` |`r round(coef(summary(geoD2))[2,2],digits=8)` | `r round(confint(geoD2)[2,],digits=8)` | `r round(coef(summary(geoD2))[2,3],digits=8)` |
| G |  `r round(coef(summary(geoG2))[2,1],digits=8)` |`r round(coef(summary(geoG2))[2,2],digits=8)` | `r round(confint(geoG2)[2,],digits=8)` | `r round(coef(summary(geoG2))[2,3],digits=8)` |
| SPD |  `r round(coef(summary(geoSPD2))[2,1],digits=8)` |`r round(coef(summary(geoSPD2))[2,2],digits=8)` | `r round(confint(geoSPD2)[2,],digits=8)` | `r round(coef(summary(geoSPD2))[2,3],digits=8)` |
| SESPD |  `r round(coef(summary(geoSESPD2))[2,1],digits=8)` |`r round(coef(summary(geoSESPD2))[2,2],digits=8)` | `r round(confint(geoSESPD2)[2,],digits=8)` | `r round(coef(summary(geoSESPD2))[2,3],digits=8)` |

## Trophic life cycle and geographic region
```{r geotrophic_new, echo=FALSE}

hp.geoTrophic <- hp.geoDirect %>% filter(Trophic == "Yes")
hp.geoTrophic$SES.PD <- hp.geoTrophic$pd.obs.z
geoTlong <- hp.geoTrophic %>% gather("index","value",c(16:19,29))

# geoTlong %>% filter(!is.na(GEO)) %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_grid(index~.,scales="free") + xlab("Geographic region") + ylab("Generalism metric")

dt <- geoTlong %>% filter(!is.na(GEO) & index=="degree") %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + xlab(NULL) + ylab("degree") + theme(legend.position="none") #+ facet_grid(index~.,scales="free") 

gt <- geoTlong %>% filter(!is.na(GEO) & index=="G") %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_count() + theme_bw() + xlab(NULL) + ylab("G") + theme(legend.position="none")
# geoDlong %>% filter(!is.na(GeoGroup)) %>% ggplot(data=.,aes(x=GeoGroup,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_wrap(~index,scales="free") 
spdt <- geoTlong %>% filter(!is.na(GEO) & index=="SPD") %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + xlab(NULL) + ylab("SPD") + theme(legend.position="none") #+ facet_grid(index~.,scales="free") 
sespdt <- geoTlong %>% filter(!is.na(GEO) & index=="SES.PD") %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + xlab("Geographic region") + ylab("SES.PD") + theme(legend.position="none") #+ facet_grid(index~.,scales="free") 

# lay=rbind(c(1),c(1),c(1),c(1),c(2))
grid.arrange(dt,gt,spdt,sespdt,ncol=1)

jpeg("~/dat/generalismtheory/trophic2.jpeg")
grid.arrange(dt,gt,spdt,sespdt,ncol=1)
dev.off()

pdf("~/dat/generalismtheory/trophic2.pdf")
grid.arrange(dt,gt,spdt,sespdt,ncol=1)
dev.off()


pdf("~/dat/generalismtheory/both2.pdf")
lay2 <- rbind(c(1,5),c(2,6),c(3,7),c(4,8))

# geoTlong %>% filter(!is.na(GEO)) %>% ggplot(data=.,aes(x=GEO,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_wrap(~index,scales="free") 
# geoTlong %>% filter(!is.na(GeoGroup)) %>% ggplot(data=.,aes(x=GeoGroup,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_wrap(~index,scales="free") 
# 
# geoTlong %>% filter(!is.na(GeoGroup) & index!="G") %>% ggplot(data=.,aes(x=GeoGroup,y=value,color=GeoGroup)) + geom_boxplot() + theme_bw() + facet_wrap(~index,scales="free") + theme(legend.position="none")

```

```{r geoanalysis_trophic, echo=FALSE,results="hide"}
# geoD <- glm.nb(data=hp.geoDirect,degree ~ GEO) 
# geoG <- glm(data=hp.geoDirect,G ~ GEO,family="binomial") 
# geoPD <- lm(data=hp.geoDirect,log(PD+0.01) ~ GEO)
# geoSPD <- lm(data=hp.geoDirect,SPD ~ GEO) 
geoD2T <- glm.nb(data=hp.geoTrophic,degree ~ GeoGroup) 
geoG2T <- glm(data=hp.geoTrophic,G ~ GeoGroup,family="binomial") 
# geoPD2T <- lm(data=hp.geoTrophic,log(PD+0.01) ~ GeoGroup)
geoSPD2T <- lm(data=hp.geoTrophic,SPD ~ GeoGroup) 
geoSESPD2T <- lm(data=hp.geoTrophic,pd.obs.z ~ GeoGroup) 
```

| Metric | Model Coefficient (ref="warm") | Std Error | Conf Int | Z-score |
|--------|-----------|-------|------|-----|
| degree |  `r round(coef(summary(geoD2T))[2,1],digits=8)` |`r round(coef(summary(geoD2T))[2,2],digits=8)` | `r round(confint(geoD2T)[2,],digits=8)` | `r round(coef(summary(geoD2T))[2,3],digits=8)` |
| G |  `r round(coef(summary(geoG2T))[2,1],digits=8)` |`r round(coef(summary(geoG2T))[2,2],digits=8)` | `r round(confint(geoG2T)[2,],digits=8)` | `r round(coef(summary(geoG2T))[2,3],digits=8)` |
| SPD |  `r round(coef(summary(geoSPD2T))[2,1],digits=8)` |`r round(coef(summary(geoSPD2T))[2,2],digits=8)` | `r round(confint(geoSPD2T)[2,],digits=8)` | `r round(coef(summary(geoSPD2T))[2,3],digits=8)` |
| SESPD |  `r round(coef(summary(geoSESPD2T))[2,1],digits=8)` |`r round(coef(summary(geoSESPD2T))[2,2],digits=8)` | `r round(confint(geoSESPD2T)[2,],digits=8)` | `r round(coef(summary(geoSESPD2T))[2,3],digits=8)` |

## Distribution of host lengths by region

```{r hostlengthregion, echo=FALSE}
# geoDlong2 <- geoDlong %>% gather(length_measure,length,c(11,13,15))
# geoDlong2 %>% filter(!is.na(GEO)) %>% ggplot(data=.,aes(x=GEO,y=length,color=GeoGroup)) + geom_boxplot() + theme_bw() + theme(legend.position="none") + facet_wrap(~length_measure)
# 
# geoTlong2 <- geoTlong %>% gather(length_measure,length,c(11,13,15))
# geoTlong2 %>% filter(!is.na(GEO)) %>% ggplot(data=.,aes(x=GEO,y=length,color=GeoGroup)) + geom_boxplot() + theme_bw() + theme(legend.position="none") + facet_wrap(~length_measure)

# pdf("~/dat/generalismtheory/geolength.pdf")
# geoTlong %>% filter(!is.na(GEO) & index!="PD") %>% ggplot(data=.,aes(y=value,x=maxMaxL,color=GeoGroup)) + geom_point() + theme_bw() + theme(legend.position="none",axis.text.x = element_text(angle = 90, hjust = 1)) + facet_grid(index ~ GEO,scales="free_y") + geom_smooth(method="lm") + ggtitle("Trophic")
# geoDlong %>% filter(!is.na(GEO) & index!="PD") %>% ggplot(data=.,aes(y=value,x=maxMaxL,color=GeoGroup)) + geom_point() + theme_bw() + theme(legend.position="none",axis.text.x = element_text(angle = 90, hjust = 1)) + facet_grid(index ~ GEO,scales="free_y") + geom_smooth(method="lm") + ggtitle("Direct")
# dev.off()

geoTlong$centermaxL <- scale(geoTlong$maxMaxL)
summary(lm(data=geoTlong[geoTlong$index=="SES.PD",], value ~ centermaxL*GeoGroup))
summary(lm(data=geoTlong[geoTlong$index=="SES.PD",], value ~ centermaxL*GEO))

geoDlong$centermaxL <- scale(geoDlong$maxMaxL)
summary(lm(data=geoDlong[geoDlong$index=="SES.PD",], value ~ centermaxL*GeoGroup))
summary(lm(data=geoDlong[geoDlong$index=="SES.PD",], value ~ centermaxL*GEO))


# summary(lm(data=geoDlong,meanMaxL ~ GeoGroup))
# 
# geoD2T <- glm.nb(data=hp.geoTrophic,degree ~ GEO*meanMaxL) 
# geoG2T <- glm(data=hp.geoTrophic,G ~ GeoGroup,family="binomial") 
# # geoPD2T <- lm(data=hp.geoTrophic,log(PD+0.01) ~ GeoGroup)
# geoSPD2T <- lm(data=hp.geoTrophic,SPD ~ GeoGroup) 
# geoSESPD2T <- lm(data=hp.geoTrophic,pd.obs.z ~ GeoGroup) 
```
